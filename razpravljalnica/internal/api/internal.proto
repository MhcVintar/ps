syntax = "proto3";

package api;

import "google/protobuf/empty.proto";

option go_package = "razpravljalnica/internal/api;api";

message WALEntry {
  enum Op {
    OP_SAVE = 0;
    OP_DELETE = 1;
  }

  enum Target {
    TARGET_USER = 0;
    TARGET_TOPIC = 1;
    TARGET_MESSAGE = 2;
    TARGET_LIKE = 3;
  }

  int64 id = 1;
  Op op = 2;
  Target target = 3;
  bytes data = 4;
}

service InternalMessageBoardService {
  // Returns WAL entries from specified id onwards
  rpc GetWALEntries(GetWALEntriesRequest) returns (GetWALEntriesResponse);

  // Rewire the node's upstream and downstream nodes
  rpc Rewire(RewireRequest) returns (google.protobuf.Empty);
}

message GetWALEntriesRequest {
  int64 from_id = 1;
}

message GetWALEntriesResponse {
  repeated WALEntry entries = 1;
}

// TODO If a field is missing, that means that there should be no connection. Also, before opening a new connection, check if it actually differs from the existing one.
message RewireRequest {
  optional string downstream_address = 1;
  optional string upstream_address = 2;
}
